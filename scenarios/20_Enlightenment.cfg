#textdomain wesnoth-To_Lands_Unknown
[scenario]
    id=20_Enlightenment
    next_scenario=21_Skydock
    name= _ "Enlightenment"
    map_data="{~add-ons/To_Lands_Unknown/maps/20_Enlightenment.map}"
    turns=-1
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC traveling_minstrels.ogg}
    {MORNING}

    [side]
        side=1
        controller=human
        team_name=mehirteam
        user_team_name= _ "team_name^Mehir"

        type=TLU_Mehir_Leader
        id=Mehir
        name= _ "Mehir"
        unrenamable=yes
        canrecruit=yes
        profile=portraits/mehir-leader.png

        {GOLD 0 0 0}
        {INCOME -2 -2 -2}

        recruit=EoMa_Water_Elemental,EoMa_Fire_Elemental,EoMa_Water_Avatar,EoMa_Fire_Avatar,EoMa_Rhami,EoMa_RhamiDatu,EoMa_RhamiKai,EoMa_Jinn
    [/side]

    [side]
        side=2
        controller=ai
        team_name=mehirteam
        user_team_name= _ "team_name^Magi"

        type=EoMa_Guru
        id=Guru
        name= _ "Guru"
        unrenamable=yes
        canrecruit=yes
        image_icon="portraits/sky_kingdom/guru.png~CROP(150,10,150,150)~SCALE(72,72)"
        {GOLD 500 700 1200}
        {INCOME 10 5 0}

        [ai]
            aggression=1.0
            caution=0
            leader_aggression=-10.0
        [/ai]

        #non-interactive
        {UNIT 2 EoMa_Mastermage 12 11 (facing=ne)}
        {UNIT 2 EoMa_Elementalist 8 10 (facing=sw)}
        {UNIT 2 EoMa_Um 5 13 (facing=se)}
        {UNIT 2 EoMa_Subversive_Mage 5 8 (facing=se)}
        {UNIT 2 EoMa_Battlemage 12 13(facing=ne)}
        {UNIT 2 EoMa_Mage_of_Water 8 13 (facing=sw)}
        {UNIT 2 EoMa_Mage_of_Fire 7 14 (facing=ne)}
        {UNIT 2 EoMa_Mage_of_Air 24 10 (facing=nw)}
        {UNIT 2 EoMa_Sculptor 5 10 (facing=sw)}
        {UNIT 2 EoMa_Black_Mage 29 11 (facing=se)}
        {UNIT 2 EoMa_Golden_Mage 28 12 (facing=se)}
        {UNIT 2 EoMa_Subversive_Mage 27 9 (facing=sw)}
        {UNIT 2 EoMa_Hidden_Face 30 10 (facing=sw)}
    [/side]

    [side]
        side=3
        controller=ai
        team_name=animhack
        user_team_name= _ "."
        hidden=yes
        color=black
        no_leader=yes
        gold=0
        income=0
    [/side]

#define TLU_GLOBE_ANIM NAME
    [unit]
        id=globe
        type=TLU_animhack
        variation={NAME}
        x=17
        y=7
        side=3
        facing=se
        placement,overwrite=map,yes
    [/unit]
    [animate_unit]
        flag={NAME}-anim
        [filter]
            id=globe
        [/filter]
    [/animate_unit]
#enddef

    #anim test events
    [event]
        name=globe
        first_time_only=no

        {TLU_GLOBE_ANIM globe}
    [/event]
    [event]
        name=globe2
        first_time_only=no

        {TLU_GLOBE_ANIM globe2}
    [/event]
    [event]
        name=globe3
        first_time_only=no

        {TLU_GLOBE_ANIM globe3}
    [/event]

    #prestart
    [event]
        name=prestart

        [recall]
            id=Rashti
            x,y=16,13
        [/recall]
        [store_unit]
            [filter]
                id=Mehir
            [/filter]
            variable=mehirvar
        [/store_unit]
        [store_unit]
            [filter]
                id=Rashti
            [/filter]
            variable=rashtivar
        [/store_unit]
        {MODIFY_UNIT id=Mehir moves 20}
        {MODIFY_UNIT id=Rashti moves 0}

        [disallow_end_turn]
        [/disallow_end_turn]

        {PLACE_HALO "scenery/library-1.png~TC(2,magenta)" 3 4}
    [/event]

    #start
    [event]
        name=start

        [message]
            speaker=Mehir
            message= _ "Wow... this place is in fact an enormous library! It is almost as big as the Grand Library of Abysmal Knowledge in al-Kamija!"
        [/message]
        [message]
            speaker=Mehir
            message= _ "We need to find that mysterious Guru. The defeated mage said he's here somewhere..."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/truerashti-noncombat.png"
            message= _ "I still don't trust these scheming magi, but it seems we don't have a choice."
        [/message]
        [objectives]
            side=1
            [objective]
                description= _ "Find Guru"
                condition=win
            [/objective]
            note= _ "This is a non-combat scenario:
-Mehir's movement refills after each move
-You cannot skip your turn
-You can interact with NPCs that have yellow exclamation marks by moving next to them
-Rashti follows you automatically"
        [/objectives]
    [/event]

    #Rashti follows Mehir automatically
    [event]
        name=select

        [filter]
            id=Rashti
        [/filter]

        [message]
            speaker=Rashti
            message= _ "I am right behind you."
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [allow_undo]
        [/allow_undo]

        [filter]
            id=Mehir
        [/filter]

        {MOVE_UNIT id=Rashti $x1 $y1}
        {MODIFY_UNIT id=Mehir moves 20}
    [/event]

#define TLU_LIBRARY_NPC ID TYPE CREATION_OPTIONS X Y ACTION
    [event]
        name=prestart

        [unit]
            id={ID}
            type={TYPE}
            side=2
            x={X}
            y={Y}
            {CREATION_OPTIONS}
            placement,overwrite=map,yes
        [/unit]
        [item]
            x,y={X},{Y}
            halo=anim/exclamation-1.png:140,anim/exclamation-2.png:140,anim/exclamation-1.png:140,anim/exclamation-3.png:140
        [/item]
    [/event]
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            id=Mehir
            [filter_adjacent]
                id={ID}
            [/filter_adjacent]
        [/filter]
        [remove_item]
            image=anim/exclamation-1.png:140,anim/exclamation-2.png:140,anim/exclamation-1.png:140,anim/exclamation-3.png:140
            x,y={X},{Y}
        [/remove_item]
        {ACTION}
    [/event]
#enddef

    {TLU_LIBRARY_NPC Mu EoMa_Mu facing=sw 19 9 (
        [message]
            speaker=Mehir
            message= _ "Hey you..."
        [/message]
        [message]
            speaker=Mu
            message= _ "Hmm? *raises eyebrows* Welcome to the Palace of Omniscience, mister! This is the very heart of the Sky Kingdom and the centre of the universe! How can I help you?"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Indeed, this place certainly looks like the centre of everything. I am looking for Guru. Do you know where I can find him?"
        [/message]
        [message]
            speaker=Mu
            message= _ "Guru is upstairs."
        [/message]
        {HIGHLIGHT_IMAGE 17 3 "items/gohere.png" ()}
        {REMOVE_IMAGE 17 3}
        [message]
            speaker=Mehir
            message= _ "Thanks."
        [/message]
        [message]
            speaker=Mu
            message= _ "You're welcome, mister 'Fancy Cap'!"
        [/message]
        [message]
            speaker=Mehir
            message= _ "...right."
        [/message]
    )}

    {TLU_LIBRARY_NPC Void EoMa_Void_Mage (facing,name=ne,_"Umbrez") 26 5 (
        [message]
            speaker=Mehir
            message= _ "Excuse me..."
        [/message]
        [message]
            speaker=Void
            message= _ "*eyes completely focused on a book* I told you, Arcanus, I need to finish this tome of 'Mastering Magic Fluctuations' first before I perform the 'intelligence enhancement ritual' on that Mu of yours. Now go and bother someone else."
        [/message]

        [message]
            speaker=Mehir
            message= _ "I'm not Arcanus, or whoever you think you're talking to."
        [/message]

        [message]
            speaker=Void
            message= _ "*closes book, looks at Mehir* Oh, my apologies, your voice is rather similar to his. Now, I would like to ask that you leave me alone stranger, I have a tome to read."
        [/message]

        [message]
            speaker=Mehir
            message= _ "Sure, whatever..."
        [/message]
    )}

    {TLU_LIBRARY_NPC Mage1 EoMa_Sorcerer (facing,name=se,_"Augurius") 9 8 (
        [message]
            speaker=Mage1
            message= _ "My, my... that's quite an extravagant costume. You look like a real Summoner! But the Masquerade Ball starts in a few days."
        [/message]
        [message]
            speaker=Mehir
            message= _ "Because I am a real Summoner?"
        [/message]
        [message]
            speaker=Mage1
            message= _ "As if I'd believe that. But I must admit you have really big chances to win first prize in the competition for the best costume this year!"
        [/message]
        [message]
            speaker=Mehir
            message= _ "*sigh* I told you, this is not a co..."
        [/message]
        [message]
            speaker=Mage1
            message= _ "And you even have a magical circle! I thought these devices were exclusive to Summoners. I've never seen anyone else using those here. This is probably an illusion spell - a very clever one. Good job!"
        [/message]
        [message]
            speaker=Mehir
            message= _ "Rashti, you tell him..."
        [/message]
        [message]
            speaker=Rashti
            image=portraits/truerashti-noncombat.png
            message= _ "Human, this is a genuine magical circle. You are talking to the leader of Tar-Tabar and I am the Queen of the Abyss. If you want more proof, I suggest you go outside and see our troops."
        [/message]
        [message]
            speaker=Mage1
            message= _ "*eyes wide open* Wait... So it's... you! Unbelievable! But how's that possible? Your kind should be in the Abyss now."
        [/message]
        [message]
            speaker=Mehir
            message= _ "I know. I didn't make it on time and I am stuck in this world for now. I was told Guru could help me and my men return to our folks in the Abyss."
        [/message]
        [message]
            speaker=Mage1
            message= _ "Ah, yes. Now I understand. Guru is definitely the person you are looking for. You can find him upstairs. Now pardon me, but I need to see those troops of yours! *to himself, with excitement in his voice* My friends won't believe me! I've met a real Summoner AND the Queen of the Abyss! This is awesome!"
        [/message]
        {MOVE_UNIT id=Mage1 16 14}
        [kill]
            id=Mage1
        [/kill]
        [message]
            speaker=Mehir
            message= _ "Did you hear that? He met 'a' summoner. At least he remembered you're 'the' Queen."
        [/message]
        [message]
            speaker=Rashti
            image=portraits/truerashti-noncombat.png
            message= _ "*smiles gently*"
        [/message]
    )}

    {TLU_LIBRARY_NPC Mage2 EoMa_Battlemage facing=nw 7 6 (
        [message]
            speaker=Mage2
            message= _ "*browses books on a shelf*... 'Assembling Golems for Beginners', 'Raising Landmasses - the Definitive Guide', 'Magic for Lazy People', 'Magic for Mus 10th edition - now with more pictures', 'Why Mus Have Small Brains - A Case Study', 'Giant Toad Mating Seasons' ...nah, this must be on a lower shelf."
        [/message]
        [message]
            speaker=Mage2
            message= _ "...'The Fall of the Ancient Cyclops' Empire', 'The Dark Mysteries of the Great Jungle', 'The Arcane Encyclopedia Vol. 1', 'Study of Dwarvish Machinery (Incomplete)', 'On Kharos Culture', 'A Deal With God - Nomolas and His Motives' ...hmm, no, I am looking for novels..."
        [/message]
        [message]
            speaker=Mage2
            message= _ "Hmm, what's that? *grabs a medium sized book from the shelf* 'To Lands Unknown - the incredible adventures of a city guard from al-Kamija'. This could be fun! *starts reading*"
        [/message]

        {BADASS_MODE_CHANGE (
            [message]
                speaker=Mehir
                message= _ "Ah, books already being written about me? Seems I am more famous than I thought."
            [/message]
        ) ()}
    )}

    #Mu/Um
    #not using the library npc macro, as the Um/Mu duo requires some different code and having the interaction be repeatable
    [event]
        name=prestart

        [unit]
            id=Um_Mu
            type=TLU_Um_Library
            side=2
            x=22
            y=11
            facing=se
            placement,overwrite=map,yes
        [/unit]
        [item]
            x,y=22,11
            halo=anim/exclamation-1.png:140,anim/exclamation-2.png:140,anim/exclamation-1.png:140,anim/exclamation-3.png:140
        [/item]
    [/event]
    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=Mehir
            [filter_adjacent]
                id=Um_Mu
            [/filter_adjacent]
        [/filter]
        [filter_condition]
            {VARIABLE_CONDITIONAL enlightenment_read_all_books not_equals yes}
        [/filter_condition]
        {BADASS_MODE_CHANGE (
            {IF_VAR enlightenment_talked_to_mu equals yes (
                [then]
                    [message]
                        speaker=Um_Mu
                        caption=_"Mu"
                        image="portraits/sky_kingdom/mu.png"
                        message= _ "*turns to Mehir* Ah, you're back! Want more books?"
                    [/message]
                [/then]
                [else]
                    {VARIABLE enlightenment_talked_to_mu yes}

                    [message]
                        speaker=Mehir
                        image="portraits/mehir-leader-shocked.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
                        message= _ "Wow... he is quite big."
                    [/message]

                    [message]
                        speaker=Um_Mu
                        message= _ "Scanning... Summoner encountered. Status: neutral, potentially dangerous."
                    [/message]

                    [message]
                        speaker=Mehir
                        message= _ "Relax, if I wanted to start a fight here I would have already done it."
                    [/message]

                    [message]
                        speaker=Um_Mu
                        message= _ "Information received, returning to duty."
                    [/message]

                    [message]
                        speaker=Um_Mu
                        caption=_"Mu"
                        message= _ "*turns to Mehir* Hello mister! Do you need help with finding a book from the top shelf?"
                        image="portraits/sky_kingdom/mu.png"
                    [/message]
                [/else]
            )}

            [message]
                speaker=Mehir
                message= _ "Sure, what books have you got there?"
            [/message]

            [message]
                speaker=Um_Mu
                caption=_"Mu"
                message= _ "Me have... First, 'Heaven's Kitchen' - a cookbook from Kharos. Second, 'That Time I Got Reincarnated As A Mu' - I like it, it has a lot of pictures, other books have a lot of complex words. Thirdly, uhhh... 'Fifty Shades of Tharis' the story of a Kharosian girl who marries a wealthy Tharis sorcerer. I don't think I'm old enough for that one yet. Which one do you want mister?"
                image="portraits/sky_kingdom/mu.png"
            [/message]
            [message]
                speaker=Mehir
                message= _ "Hmmmm... what book to choose..."
                [option]
                    image="icons/book.png"
                    label= _ "Heaven's Kitchen"
                    [show_if]
                        {VARIABLE_CONDITIONAL enlightenment_book_cookbook not_equals yes}
                    [/show_if]
                    [command]
                        [message]
                            speaker=Mehir
                            message= _ "Alright, time to give this one a read..."
                        [/message]
                        [delay]
                            time=1000
                        [/delay]
                        [message]
                            speaker=Mehir
                            message= _ "A lot of the recipes involve so-called 'crabs' and 'lamb sauce'. Sounds quite delicious. Now I regret not tasting some of these back when I was still in Kharos..."
                        [/message]
                        {VARIABLE enlightenment_book_cookbook yes}#might probably use this to add a bit of extra dialog in Ruins
                    [/command]
                [/option]
                [option]
                    image="icons/book.png"
                    label= _ "That Time I Got Reincarnated As A Mu"
                    [show_if]
                        {VARIABLE_CONDITIONAL enlightenment_book_manga not_equals yes}
                    [/show_if]
                    [command]
                        [message]
                            speaker=Mehir
                            message= _ "Alright, time to give this one a read..."
                        [/message]
                        [delay]
                            time=1000
                        [/delay]
                        [message]
                            speaker=Mehir
                            message= _ "The Mu was right, it does have plenty of pictures. The story was alright though."
                        [/message]
                        {VARIABLE enlightenment_book_manga yes}
                    [/command]
                [/option]
                [option]
                    image="icons/book2.png"
                    label= _ "Fifty Shades of Tharis"
                    [show_if]
                        {VARIABLE_CONDITIONAL enlightenment_book_tharis not_equals yes}
                    [/show_if]
                    [command]
                        [message]
                            speaker=Mehir
                            message= _ "Alright, time to give this one a read..."
                        [/message]
                        [delay]
                            time=1000
                        [/delay]

                        [message]
                            speaker=Rashti
                            image="portraits/truerashti-noncombat.png"
                            message= _ "Wow... uhh... I didn't know you liked THOSE kinds of books."
                        [/message]

                        [message]
                            speaker=Mehir
                            message= _ "Uh, it's not what it looks like, I swear! I was just curious and all."
                        [/message]

                        [message]
                            speaker=Rashti
                            image="portraits/truerashti-noncombat.png"
                            message= _ "*sigh* Fine, let's pretend we never saw this."
                        [/message]

                        {VARIABLE enlightenment_book_tharis yes}
                    [/command]
                [/option]
            [/message]
        ) (
            [message]
                speaker=Mehir
                image="portraits/mehir-leader-shocked.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
                message= _ "Wow... he is quite big. I'd rather not mess with this guy."
            [/message]
            {REMOVE_IMAGE 22 11}
        )}

        [if]
            {VARIABLE_CONDITIONAL enlightenment_book_cookbook equals yes}
            [and]
                {VARIABLE_CONDITIONAL enlightenment_book_manga equals yes}
            [/and]
            [and]
                {VARIABLE_CONDITIONAL enlightenment_book_tharis equals yes}
            [/and]
            [then]
                {VARIABLE enlightenment_read_all_books yes}
            [/then]
        [/if]

        {IF_VAR enlightenment_read_all_books equals yes (
            [then]
                [message]
                    speaker=Rashti
                    image="portraits/truerashti-noncombat.png"
                    message= _ "I think that's enough reading for now. As great as the library is, we have more pressing matters."
                [/message]
                [message]
                    speaker=Mehir
                    message= _ "Alright..."
                [/message]
                [remove_item]
                    image=anim/exclamation-1.png:140,anim/exclamation-2.png:140,anim/exclamation-1.png:140,anim/exclamation-3.png:140
                    x,y=22,11
                [/remove_item]
            [/then]
        )}
    [/event]

#define STAIRCASE X1 Y1 X2 Y2
    [tunnel]
        [filter]
        [/filter]
        [source]
            x,y={X1},{Y1}
        [/source]
        [target]
            x,y={X2},{Y2}
        [/target]
    [/tunnel]
#enddef

    #globe
    [event]
        name=prestart

        [item]
            x,y=17,8
            halo=anim/exclamation-1.png:140,anim/exclamation-2.png:140,anim/exclamation-1.png:140,anim/exclamation-3.png:140
        [/item]

        {STAIRCASE 27 6 26 10}
    [/event]
    [event]
        name=moveto
        first_time_only=yes

        [filter]
            id=Mehir
            x,y=17,8
        [/filter]
        {REMOVE_IMAGE 17 8}
        [message]
            speaker=Mehir
            message= _ "Man, that globe is really big. Hmm, let me take a closer look..."
        [/message]

        {BADASS_MODE_CHANGE (
            [move_unit]
                id=Mehir
                check_passability=no
                to_x,to_y=17,5
            [/move_unit]

            {TELEPORT_UNIT id=Mehir 17 5}

            [message]
                speaker=Rashti
                image="portraits/truerashti-noncombat.png"
                message= _ "When you said you'd take a closer look, I didn't think you mean THAT close."
            [/message]

            [message]
                speaker=Mehir
                message= _ "Standing on top of the entire known world feels good."
            [/message]

            [message]
                speaker=Void
                message= _ "Get off the globe! This is precious equipment you're stomping on. Argh, gonna have to get the mus to clean it again..."
            [/message]

            [move_unit]
                id=Mehir
                check_passability=no
                to_x,to_y=17,8
            [/move_unit]
        ) (
        )}

        [message]
            speaker=Mehir
            message= _ "I don't recognize any of these lands on this side. These must be other continents of this planet. When our ancestors had discovered the Abyss and settled in al-Kamija, they entirely gave up on world exploration."
        [/message]
        [message]
            speaker=Mehir
            message= _ "You can't blame them. They were just safe from the dangers of the outside world, living an isolationist utopian life together with their Abyssmal servants in the middle of the Great Desert for centuries."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/truerashti-noncombat.png"
            message= _ "I scouted the borders of the Great Desert with my third master more than 250 years ago but we didn't go very far. There were no flying carpets at that time. And Jinn, well, they had their own affairs."
        [/message]
    [/event]

    {TLU_LIBRARY_NPC guardian1 EoMa_Sky_Guardian (facing,name=sw,_ "Guardian") 12 4 (
        {VARIABLE skyguardian left}
        [role]
            role=guardian
            id=guardian1
        [/role]
        {REMOVE_IMAGE 22 4}
        [fire_event]
            name=guru
        [/fire_event]
    )}
    {TLU_LIBRARY_NPC guardian2 EoMa_Sky_Guardian (facing,name=se,_ "Guardian") 22 4 (
        {VARIABLE skyguardian right}
        [role]
            role=guardian
            id=guardian2
        [/role]
        {REMOVE_IMAGE 12 4}
        [fire_event]
            name=guru
        [/fire_event]
    )}

    #guru
    [event]
        name=guru

        #remove all exclamation marks
        {REMOVE_IMAGE 7 6}
        {REMOVE_IMAGE 9 8}
        {REMOVE_IMAGE 17 8}
        {REMOVE_IMAGE 19 9}
        {REMOVE_IMAGE 26 5}
        {IF_VAR skyguardian equals left (
            [then]
                {MODIFY_UNIT id=Mehir facing ne}
            [/then]
            [else]
                {MODIFY_UNIT id=Mehir facing nw}
            [/else]
        )}
        [message]
            speaker=Mehir
            message= _ "Uh, excuse me..."
        [/message]
        [message]
            role=guardian
            message= _ "..."
        [/message]
        [message]
            speaker=Mehir
            message= _ "I am here to see Guru over a very important matter."
        [/message]
        [message]
            role=guardian
            message= _ "..."
        [/message]
        [message]
            speaker=Mehir
            message= _ "Not a talkative person, are you?"
        [/message]
        [message]
            role=guardian
            message= _ "..."
        [/message]
        {TLU_SMOOTH_REPLACE_MUSIC silence.ogg 2000 0}

        {IF_VAR skyguardian equals left (
            [then]
                {MOVE_UNIT id=Guru 16 3}
            [/then]
            [else]
                {MOVE_UNIT id=Guru 18 3}
            [/else]
        )}
        {REPLACE_SCENARIO_MUSIC zhaytee_newtruths.ogg}
        [message]
            speaker=Guru
            message= _ "Ah, welcome to the Palace of Omniscience, Mehir. Though I am generally above such petty things as entertainment, I must admit, you impressed me. You are the first visitor from the surface to reach the palace, and that's no small feat, mind you."
        [/message]
        {IF_VAR skyguardian equals left (
            [then]
                {MOVE_UNIT id=Mehir 11 6}
                {MOVE_UNIT id=Rashti 10 6}
                {MODIFY_UNIT id=Rashti facing se}
                {MODIFY_UNIT id=Mehir facing se}
            [/then]
            [else]
                {MOVE_UNIT id=Mehir 23 6}
                {MOVE_UNIT id=Rashti 24 6}
                {MODIFY_UNIT id=Rashti facing sw}
                {MODIFY_UNIT id=Mehir facing nw}
            [/else]
        )}
        [message]
            speaker=Mehir
            message= _ "Those magi told that you're the person who can help me return to my people in the Abyss, and made me fight my way here, so it better be true..."
        [/message]
        [message]
            speaker=Guru
            message= _ "Ah, yes, I do know how to make it happen. *turns to his people* Gentlemen, I need to discuss something with our guests here in private. Vacate the library until we are done."
        [/message]
        {FADE_TO_BLACK}
        [kill]
            side=2
            [not]
                id=Guru
            [/not]
            animate=no
        [/kill]
        {REMOVE_IMAGE 3 4}
        {REMOVE_IMAGE 22 11}
        {TELEPORT_UNIT id=Guru 17 9}
        {FADE_IN}
        [message]
            speaker=Guru
            message= _ "Much better... Where was I? Ah, yes. I know how to help you, but unfortunately opening a passage to to the Abyss without the usage of abyssal magic requires an enormous amount of energy. It exceeds even our capabilities... at least at the moment."
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
            message= _ "What?! Are you saying that all my effort of getting here was pointless?! There's no way I'm leaving this place empty-handed! There <b>must</b> be something I can do."
        [/message]
        [message]
            speaker=Guru
            message= _ "Fortunately for you, there is a solution, but it will require some work on your part. You see, there are objects in this world that can store very large quantities of magic over time. If you could bring us one, we could release its accumulated power to open a gate for you."
        [/message]
        [message]
            speaker=Mehir
            message= _ "So there is still some hope. Where could I find such an object?"
        [/message]
        [message]
            speaker=Guru
            message= _ "As a matter of fact, we do know the locations of two of them. The first is in the hands of the people of Kharos. It is their holiest artifact; they call it the ‘Sun Ray’."
        [/message]
        [message]
            speaker=Mehir
            message= _ "Huh... Anthi never mentioned it, wonder why..."
        [/message]
        [message]
            speaker=Guru
            message= _ "Not surprising, considering that it is their greatest treasure: the source of power of all Sun Warriors. Anthi would never tell a stranger about this."
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
            message=_ "And you want me to steal it? Hell no! The people of Kharos helped me get here, they gave me hope, and besides, what kind of heartless traitor would I be to take the thing they hold most dear right after saving them?! I'd rather sell my soul than that!"
        [/message]
        [message]
            speaker=Guru
            message= _ "*smiles lightly* I knew you wouldn’t do such a thing. You are a good person, Mehir, but good people always have it harder than the rest..."
        [/message]
        [delay]
            time=1000
        [/delay]
        [message]
            speaker=Guru
            message= _ "There is another power source, very far away from here, in one of the most distant places of all..."
        [/message]
        #apply motion to the globe - show North Pole
        {TLU_GLOBE_ANIM globe}
        [message]
            speaker=Guru
            message= _ "You have to bring us one of the ‘batteries’ of the Runemasters — an ancient civilization that perished thousands of years ago."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Go far away, search some ruins, find that thing and bring it back — sounds fairly easy."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/truerashti-noncombat.png"
            message= _ "It's never that simple, Mehir. If it was, the battery would've already been taken and studied."
        [/message]
        [message]
            speaker=Guru
            message=_ "Your companion is correct, there is indeed always a catch. You see, the Runemasters are gone, but this place is protected by their mechanical creations, like your cities were protected by your abysmal beings."
        [/message]
        [message]
            speaker=Mehir
            message=_ "A bunch of ancient guardians shouldn't be too difficult to defeat."
        [/message]
        [message]
            speaker=Guru
            message=_ "It won't be, as your army proved to be powerful enough. But there is a chance you will encounter the remnants of something more... terrifying. Believe me, it won't be easy."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Hmmm... this better not be another trick of yours... By the way, I have so many questions I want to ask. Can I stay a little longer and do so?"
        [/message]
        [message]
            speaker=Guru
            message=_ "Sure, I'm listening. After all, we do owe you some explanations."
        [/message]
        [message]
            speaker=Mehir
            message=_ "I've been wondering... Who exactly are you people? It almost seems like you're gods of this place."
        [/message]
        [message]
            speaker=Guru
            message=_ "Oh, believe me, we are far from gods, but we know far more than others. We are just a group of people with the goal to study the world and it's secrets, for science. One would say - 'knowledge is power' - we agree with this philosophy to a certain extent. But sometimes ignorance is bliss..."
        [/message]
        [message]
            speaker=Guru
            message=_ "Some nations are aware of us, but we try not to interfere, and don't want to get tangled in others' wars. That is why we live in such a remote place."
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
            message=_ "‘try not to interfere’?! ‘don't want to get tangled in others' wars’?! You expect me to believe such drivel?! I fought your kind in our territory - TWICE! At first, they attempted to steal one of our artifacts, and later defiled one of our sacred places and murdered one of our leaders!"
        [/message]
        [message]
            speaker=Rashti
            #Rashti using the combat portrait here is intentional, considering how angry she is
            message= _ "The death of my former master is on your subordinate's hands, you better have a good explanation, mage."
        [/message]
        [message]
            speaker=Guru
            message=_ "Please put away your weapons, there is no need for even more needless violence than Aerius, our cartographer, already caused. We sent him on a mission to learn more about your civilization. He was given resources for this task, but alas it looks like he used them in a wrong way... <i>or not...</i>"
        [/message]
        #show the Great Desert
        {TLU_GLOBE_ANIM globe2}
        [message]
            speaker=Guru
            message=_ "Your young country was something completely new to us. The development pace of your Abyss-based civilization was extremely rapid, and quickly gained our attention. We wanted to learn more about you, and your intentions. Thankfully your kind seems to be peaceful in nature and similar to us in some ways."
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-angry.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
            message=_ "So what, just because we're peaceful you thought we can just be pushed around?"
        [/message]
        [message]
            speaker=Guru
            message=_ "I understand your anger. The Master Council's decision to choose Aerius was a failure, <i>*to himself* but also an extraordinary success...</i> , we did not anticipate how violent his... research methods would be. I do sincerely apologize for all the harm caused by Aerius's actions."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/truerashti-noncombat.png"
            message=_ "If you truly want to earn our forgiveness, help us retreive this battery instead of merely pointing where it is and having us do all the dirty work. Otherwise, who's to say you aren't just trying to get rid of us by sending us to our deaths in some frozen wasteland?"
        [/message]
        [message]
            speaker=Guru
            message=_"Your concern is understandable, but, I assure you, getting rid of you is not my goal. This arrangement is beneficial for us both - you get to return home, we get an ancient artifact to study as well as mend the strained relations between our nations. Besides, if I were your enemy, I wouldn't be putting my life at risk by standing unarmed without bodyguards in front of someone as powerful as the Queen of the Abyss. Neither of us has anything to gain from the other's death."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/truerashti-noncombat.png"
            message=_ "Hmph... I suppose you do make a point there."
        [/message]
        [message]
            speaker=Guru
            message=_"To prove our good intentions, I'll help you as much as I can. Firstly, I will personally order three of our Ums to aid you in your journey. You probably noticed a muscular giant next to the bookshelves when you entered the Library. That was one of them. Ums are powerful beings, trust me."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Yeah, I can see that."
        [/message]
        [message]
            speaker=Guru
            message=_ "Also, no offense, but your personal circle is a tad bit too primitive for the task at hand."
        [/message]
        [message]
            speaker=Mehir
            message=_ "What? This is the personal megacircle - the pinnacle of our abysmal design!"
        [/message]
        {BADASS_MODE_CHANGE (
            [message]
                speaker=Mehir
                message=_ "Mine even has a special feature of summoning my deputy while he's bathing!"
            [/message]
            [message]
                speaker=Guru
                message=_ "Really? That's quite a novelty in sorcery... "
            [/message]
        ) ()}
        [message]
            speaker=Guru
            message=_ "Well, we know how to upgrade it further, for free! Consider this part of the apology for the damage Aerius has done. I'll tell Umbrez, one of our void mages who knows a great deal about abyssal magic, to do just that. Meet him at the Northern Skydock, he'll upgrade your circle with our magic."
        [/message]
        [message]
            speaker=Mehir
            image="portraits/mehir-leader-happy.png{TLU_MEHIR_PORTRAIT_ELEMENTS}"
            message=_ "Great! Any help from you will prove useful. I didn't expect that you would help us so much in the first place."
        [/message]
        [message]
            speaker=Guru
            message=_ "You can still ask a few more questions if you want."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Ah, yes. So, I've been wondering: your so-called 'Mu's seem oddly similar to the goblins I fought in the south. Are they perhaps the same species?"
        [/message]
        [message]
            speaker=Guru
            message=_ "Indeed, a Mu is merely a magically and technically augmented goblin. Goblins make for pretty good test subjects. We kidna- erm, gather hundreds of them from the south each year."
        [/message]
        [message]
            speaker=Rashti
            image="portraits/truerashti-noncombat.png"
            message=_ "Sounds... rather cruel."
        [/message]
        [message]
            speaker=Guru
            message=_ "Honestly, staying with the barbarians and being used as cannon fodder or a walking bomb is hardly a better fate. At least here they contribute to the advancement of science."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Right..."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Another, more important question: Since you claim that you observe things from here, then I am sure you are aware that Kharos was under attack by unknown forces. Kharosians know about your kingdom, they even trade with you, yet you didn't help them. Why?"
        [/message]
        #show Kharos
        {TLU_GLOBE_ANIM globe3}
        [message]
            speaker=Guru
            message=_ "Because of your arrival, our intervention was simply unnecessary at that point. You managed to fend the Tharis crusade off with ease."
        [/message]
        [message]
            speaker=Mehir
            message=_ "So they are called Tharis... I wonder, why Anthi sent Atiros to us asking for help instead of sending him to you. This is what I meant when asking the question."
        [/message]
        [message]
            speaker=Guru
            message=_ "For several reasons. Firstly, we were unreachable at that point as our Sky Kingdom constantly moves over the ocean. When we are above continents we occasionally visit the surface, trade with people there, then move back over the ocean. We visit Kharos several times per year."
        [/message]
        [message]
            speaker=Guru
            message=_ "And secondly, Kharosians know that we have a neutral status. They knew we wouldn't help them. But the most ironic part is, they didn't even need help. Even yours..."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Wait, what exactly do you mean?"
        [/message]
        [message]
            speaker=Guru
            message=_ "The Sun Ray - their holiest artifact I mentioned earlier - contains so much power, that releasing it in front of the Tharis forces would melt their whole army in an instant. But Anthi does not want to mess with it. She even refused to direct more of its power to her warriors <i>*to himself* because we agreed so</i>. Had she done otherwise, they would have likely stopped the Tharis by themselves."
        [/message]
        [message]
            speaker=Guru
            message=_ "But she decided to search for other solutions. Anthi probably only wanted to use the Sun Ray as a last resort."
        [/message]
        [message]
            speaker=Mehir
            message=_ "So you want to tell me that my journey to Kharos was completely unnecessary?"
        [/message]
        [message]
            speaker=Guru
            message=_ "It depends on your perspective, but pretty much yes."
        [/message]
        [message]
            speaker=Mehir
            message=_ "If this is true, that they could've won without us... Dear Nomolas... I led my people for nothing. And now we are stuck here..."
        [/message]
        [message]
            speaker=Guru
            message=_ "Well, at least you have traveled the world, embarked on an quest, and met some interesting people."
        [/message]
        [message]
            speaker=Guru
            message=_ "Also, had you not helped Kharos, we wouldn't have met <i>*to himself* which would have completely ruined the plan</i>. Besides, once you return to the Abyss, you'll have plenty of stories to tell your people, about all the things you've been through. You'll be known as a legend!"
        [/message]
        [message]
            speaker=Mehir
            message=_ "You are right. I think it had to be that way. So what about Tharis? Who are they? Will they stop invading Kharos? And why did they even attack? Their magic is powerful, maybe even comparable with yours. Aren't you afraid?"
        [/message]
        #show Tharis
        {TLU_GLOBE_ANIM globe4}
        [message]
            speaker=Guru
            message=_ "Afraid of them? Hardly, if at all. Their armies certainly are very powerful, but they are unable to reach the Sky Kingdom, since, as you have seen, even your best carpet riders can't fly that high, not to mention the Tharis magi, who can only hover a few meters above the surface. Anyway, as for the Tharis themselves, they're are a strange nation with a cult of darkness as their religion. Their lands are very far away, and they've killed many of the scouts we sent to their land, so gathering information about them has proven to be a difficult task, to say the least."
        [/message]
        [message]
            speaker=Mehir
            message=_ "I see. Though there's one more thing about them I want to know: They've been rambling about the return of the 'Destroyers', who would 'spare them if they prove themselves worthy'. Sounds like just a myth, but I'd like to be sure."
        [/message]
        [message]
            speaker=Guru
            message=_ "*gives Mehir a nervous look* Those things are no mere myths, summoner. They wiped out no less than five civilizations, including the Runemasters! Those spawns of darkness are able to reanimate the dead as their puppets. Thankfully their invasion has been stopped, but their remnants still haunt some desolate parts of the world..."
        [/message]
        [message]
            speaker=Mehir
            message=_ "Wow... I really hope not to run into those things on my trip to the ruins..."
        [/message]
        #reset to North Pole
        {TLU_GLOBE_ANIM globe5}
        [message]
            speaker=Guru
            message=_ "Go for that battery. We will do the rest."
        [/message]
        {IF_VAR skyguardian equals left (
            [then]
                {MOVE_UNIT id=Mehir 12 8}
                {MOVE_UNIT id=Rashti 11 8}
            [/then]
            [else]
                {MOVE_UNIT id=Mehir 22 8}
                {MOVE_UNIT id=Rashti 23 8}
            [/else]
        )}
        {MOVE_UNIT id=Mehir 17 10}
        {MOVE_UNIT id=Rashti 17 9}
        {MOVE_UNIT id=Mehir 17 14}
        {MOVE_UNIT id=Rashti 17 13}

        [hide_unit]
            id=Mehir
        [/hide_unit]
        [hide_unit]
            id=Rashti
        [/hide_unit]

        [message]
            speaker=Guru
            message= _ "It has started. Finally."
        [/message]
        {MODIFY_UNIT id=Mehir moves $mehirvar.max_moves}
        {MODIFY_UNIT id=Rashti moves $rashtivar.max_moves}
        {CLEAR_VARIABLE mehirvar}
        [endlevel]
            result=victory
            bonus=no
            {NEW_GOLD_CARRYOVER 100}
            carryover_report=no
            linger_mode=no
        [/endlevel]
    [/event]

#define STAIRS_OFFSET
    x=0~36:1000,36~-54:1000
    y=0~324:2000
#enddef

#define STAIRS_OFFSET2
    x=0~90:1000,90~54:1000
    y=0~-324:2000
#enddef

#define STAIRS_OFFSET3
    x=0~-36:1000,-36~54:1000
    y=0~-324:2000
#enddef

#define STAIRS_OFFSET4
    x=0~-90:1000,-90~-54:1000
    y=0~324:2000
#enddef

    #stairs animation
    [event]
        name=prestart

        [object]
            silent=yes
            duration=forever
            [filter]
                id=Mehir
            [/filter]
            [effect]
                apply_to=new_animation
                [animation]
                    apply_to=pre_teleport
                    base_score=999 #always use this
                    [filter]
                        x,y=27,6
                    [/filter]

                    start_time=-2000

                    circle1_start_time=-2000
                    circle2_start_time=-2000
                    circle3_start_time=-2000
                    [circle1_frame]
                        duration=2000
                        image=halo/ucircle-frames/ucircle-b-07.png
                        image_mod="~SCALE(270,190)"
                        auto_vflip=false
                        layer=0
                        alpha=0.6~0.8:500,0.8~0.6:500
                        {STAIRS_OFFSET}
                    [/circle1_frame]
                    [circle2_frame]
                        duration=2000
                        auto_vflip=false
                        layer=0
                        alpha=0.8~1:500,1~0.8:500
                        {STAIRS_OFFSET}
                    [/circle2_frame]
                    [circle3_frame]
                        duration=2000
                        image=halo/ucircle-frames/ucircle-b-07.png
                        image_mod="~SCALE(108,76)"
                        auto_vflip=false
                        layer=0
                        alpha=0.8~1:500,1~0.8:500
                        {STAIRS_OFFSET}
                    [/circle3_frame]
                    [frame]
                        image=units/summoners-humans/summonerIVa.png:2000
                        image_mod="~FL()"
                        layer=30
                        auto_vflip=no
                        {STAIRS_OFFSET}
                    [/frame]
                [/animation]
                [animation]
                    apply_to=pre_teleport
                    base_score=999 #always use this
                    [filter]
                        x,y=26,10
                    [/filter]

                    start_time=-2000

                    circle1_start_time=-2000
                    circle2_start_time=-2000
                    circle3_start_time=-2000
                    [circle1_frame]
                        duration=2000
                        image=halo/ucircle-frames/ucircle-b-07.png
                        image_mod="~SCALE(270,190)"
                        auto_vflip=false
                        layer=0
                        alpha=0.6~0.8:500,0.8~0.6:500
                        {STAIRS_OFFSET2}
                    [/circle1_frame]
                    [circle2_frame]
                        duration=2000
                        auto_vflip=false
                        layer=0
                        alpha=0.8~1:500,1~0.8:500
                        {STAIRS_OFFSET2}
                    [/circle2_frame]
                    [circle3_frame]
                        duration=2000
                        image=halo/ucircle-frames/ucircle-b-07.png
                        image_mod="~SCALE(108,76)"
                        auto_vflip=false
                        layer=0
                        alpha=0.8~1:500,1~0.8:500
                        {STAIRS_OFFSET2}
                    [/circle3_frame]
                    [frame]
                        image=units/summoners-humans/summonerIVa.png:2000
                        image_mod="~FL()"
                        layer=30
                        auto_vflip=no
                        {STAIRS_OFFSET2}
                    [/frame]
                [/animation]
                [animation]
                    apply_to=post_teleport
                    base_score=999 #always use this

                    start_time=-1

                    circle1_start_time=-1
                    circle2_start_time=-1
                    circle3_start_time=-1
                    [circle1_frame]
                        duration=2
                        image=halo/ucircle-frames/ucircle-b-07.png
                        image_mod="~SCALE(270,190)"
                        auto_vflip=false
                        layer=0
                        alpha=0.6~0.8:1,0.8~0.6:1
                        {STAIRS_OFFSET}
                    [/circle1_frame]
                    [circle2_frame]
                        duration=2
                        auto_vflip=false
                        layer=0
                        alpha=0.8~1:1,1~0.8:1
                        {STAIRS_OFFSET}
                    [/circle2_frame]
                    [circle3_frame]
                        duration=2
                        image=halo/ucircle-frames/ucircle-b-07.png
                        image_mod="~SCALE(108,76)"
                        auto_vflip=false
                        layer=0
                        alpha=0.8~1:1,1~0.8:1
                        {STAIRS_OFFSET}
                    [/circle3_frame]
                    [frame]
                        image=units/summoners-humans/summonerIVa.png:2
                        image_mod="~FL()"
                        layer=30
                        auto_vflip=no
                        {STAIRS_OFFSET}
                    [/frame]
                [/animation]
            [/effect]
        [/object]
    [/event]

    {ITEM_APPLIER}
    {TLU_S20_TERRAIN}
[/scenario]
